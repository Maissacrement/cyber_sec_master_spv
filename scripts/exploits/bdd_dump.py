from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
import time

# Configuration
adminer_url = "http://wordpress-tp.local:31337/adminer.php"
user = "root"
password = "password"

# Démarrer Chrome en headless
options = Options()
options.add_argument("--headless")
options.add_argument("--no-sandbox")
options.add_argument("--disable-dev-shm-usage")
driver = webdriver.Chrome(options=options)

try:
    print("[*] Ouverture d'Adminer...")
    driver.get(adminer_url)

    print("[*] Remplissage du formulaire...")
    driver.find_element(By.NAME, "auth[driver]").send_keys("MySQL")
    driver.find_element(By.NAME, "auth[server]").clear()
    driver.find_element(By.NAME, "auth[server]").send_keys("localhost")
    driver.find_element(By.NAME, "auth[username]").send_keys(user)
    driver.find_element(By.NAME, "auth[password]").send_keys(password)

    driver.find_element(By.XPATH, "//input[@type='submit']").click()
    time.sleep(2)

    print("[*] Connexion réussie ? Vérification...")
    if "Logout" not in driver.page_source:
        print("[!] Échec de connexion.")
        driver.quit()
        exit(1)

    print("[+] Connexion réussie.")
    print("[*] Récupération des bases de données...")
    page = driver.page_source

    # Sauvegarde simple
    with open("adminer_dump.html", "w") as f:
        f.write(page)

    print("[+] Page enregistrée dans adminer_dump.html (à parser si besoin).")

finally:
    driver.quit()
